

pipeline {
  agent any

  environment {
    DOCKERHUB = credentials('DockerHub')
  }

  stages{

    stage('Docker Login') {
      steps {
        sh '''
          echo $DOCKERHUB_PSW | docker login -u $DOCKERHUB_USR --password-stdin
        '''
      }
    }

stage('Pull , build and Run dockerfile ') {
      steps {
       
      sh '''
                docker stop myapp4 || true
		        docker rm myapp4 || true
		        docker rmi bassam2080/myapp4 || true
		        docker build -t bassam2080/myapp4-web  . 
				  
        
        '''
      }
    }
      

    stage('Deploy') {
      steps {
       // runs the same stack of dependensies as your local machine
        sh 'docker compose up -d'
      }
    }
  }
}
